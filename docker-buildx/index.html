<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" >
<meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
<title>docker å¤šæ¶æ„æ„å»ºé•œåƒ | å°ä¸çš„blog</title>

<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">

<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.2/css/all.css" integrity="sha384-fnmOCqbTlWIlj8LyTjo7mOUStjsKC4pOpQbqyi7RrhN7udi9RwhKkMHpvLbHG9Sr" crossorigin="anonymous">
<link rel="shortcut icon" href="https://maodou38.github.io/favicon.ico?v=1598831345045">
<link rel="stylesheet" href="https://maodou38.github.io/styles/main.css">


  
    <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css" />
  

  


<link rel="stylesheet" href="https://unpkg.com/aos@next/dist/aos.css" />
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>


<script async src="https://www.googletagmanager.com/gtag/js?id=UA-163411650-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-163411650-1');
</script>


    <meta name="description" content="å¼€å¯docker buildx
åœ¨/root/.dockerç›®å½•ä¸‹æœ‰ä¸€ä¸ªconfig.jsonæ–‡ä»¶ï¼ŒåŠ ä¸Š
&quot;experimental&quot; : &quot;enabled&quot;

é‡å¯docker
éªŒè¯æ˜¯å¦å¼€å¯
ğŸ³ ..." />
    <meta name="keywords" content="docker" />
  </head>
  <body>
    <div id="app" class="main">

      <div class="sidebar" :class="{ 'full-height': menuVisible }">
  <div class="top-container" data-aos="fade-right">
    <div class="top-header-container">
      <a class="site-title-container" href="https://maodou38.github.io">
        <img src="https://maodou38.github.io/images/avatar.png?v=1598831345045" class="site-logo">
        <h1 class="site-title">å°ä¸çš„blog</h1>
      </a>
      <div class="menu-btn" @click="menuVisible = !menuVisible">
        <div class="line"></div>
      </div>
    </div>
    <div>
      
        
          <a href="https://maodou38.github.io" class="site-nav">
            ä¸»é¡µ
          </a>
        
      
        
          <a href="https://maodou38.github.io/tags" class="site-nav">
            æ ‡ç­¾
          </a>
        
      
        
          <a href="https://maodou38.github.io/archives" class="site-nav">
            å½’æ¡£
          </a>
        
      
    </div>
  </div>
  <div class="bottom-container" data-aos="flip-up" data-aos-offset="0">
    <div class="social-container">
      
        
      
        
      
        
      
        
      
        
      
    </div>
    <div class="site-description">
      <div><span>åœ¨æŠ€æœ¯çš„é“è·¯ä¸Šæ…¢æ…¢æ‰¾å¯»è‡ªæˆ‘çš„ä»·å€¼</span>
                                             <span class="rt">  â€”â€”â€”å°ä¸ 
   </span></div>
    </div>
    <div class="site-footer">
      Powered by <a href="https://github.com/maodou38">randing</a> | <a class="rss" href="https://maodou38.github.io/atom.xml" target="_blank">RSS</a>
    </div>
  </div>
</div>


      <div class="main-container">
        <div class="content-container" data-aos="fade-up">
          <div class="post-detail">
            <h2 class="post-title">docker å¤šæ¶æ„æ„å»ºé•œåƒ</h2>
            <div class="post-date">2020-08-25</div>
            
            <div class="post-content" v-pre>
              <h1 id="å¼€å¯docker-buildx">å¼€å¯docker buildx</h1>
<p>åœ¨/root/.dockerç›®å½•ä¸‹æœ‰ä¸€ä¸ªconfig.jsonæ–‡ä»¶ï¼ŒåŠ ä¸Š</p>
<pre><code>&quot;experimental&quot; : &quot;enabled&quot;
</code></pre>
<p>é‡å¯docker</p>
<h2 id="éªŒè¯æ˜¯å¦å¼€å¯">éªŒè¯æ˜¯å¦å¼€å¯</h2>
<pre><code>ğŸ³ â†’ docker buildx version
github.com/docker/buildx v0.3.1-tp-docker 6db68d029599c6710a32aa7adcba8e5a344795a7
</code></pre>
<p>å¦‚æœåœ¨æŸäº›ç³»ç»Ÿä¸Šè®¾ç½®ç¯å¢ƒå˜é‡ DOCKER_CLI_EXPERIMENTAL ä¸ç”Ÿæ•ˆï¼ˆæ¯”å¦‚ Arch Linuxï¼‰,ä½ å¯ä»¥é€‰æ‹©ä»æºä»£ç ç¼–è¯‘ï¼š</p>
<pre><code>ğŸ³ â†’ export DOCKER_BUILDKIT=1
ğŸ³ â†’ docker build --platform=local -o . git://github.com/docker/buildx
ğŸ³ â†’ mkdir -p ~/.docker/cli-plugins &amp;&amp; mv buildx ~/.docker/cli-plugins/docker-buildx
</code></pre>
<h1 id="å¯ç”¨-binfmt_misc">å¯ç”¨ binfmt_misc</h1>
<blockquote>
<p>å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Docker æ¡Œé¢ç‰ˆï¼ˆMacOS å’Œ Windowsï¼‰ï¼Œé»˜è®¤å·²ç»å¯ç”¨äº† binfmt_miscï¼Œå¯ä»¥è·³è¿‡è¿™ä¸€æ­¥ã€‚<br>
å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Linuxï¼Œéœ€è¦æ‰‹åŠ¨å¯ç”¨ binfmt_miscã€‚å¤§å¤šæ•° Linux å‘è¡Œç‰ˆéƒ½å¾ˆå®¹æ˜“å¯ç”¨ï¼Œä¸è¿‡è¿˜æœ‰ä¸€ä¸ªæ›´å®¹æ˜“çš„åŠæ³•ï¼Œç›´æ¥è¿è¡Œä¸€ä¸ªç‰¹æƒå®¹å™¨ï¼Œå®¹å™¨é‡Œé¢å†™å¥½äº†è®¾ç½®è„šæœ¬ï¼š</p>
</blockquote>
<pre><code>ğŸ³ â†’ docker run --rm --privileged docker/binfmt:66f9012c56a8316f9244ffd7622d7c21c1f6f28d    
</code></pre>
<blockquote>
<p>å»ºè®®å°† Linux å†…æ ¸ç‰ˆæœ¬å‡çº§åˆ° 4.x ä»¥ä¸Šï¼Œç‰¹åˆ«æ˜¯ CentOS ç”¨æˆ·ï¼Œä½ å¯èƒ½ä¼šé‡åˆ°é”™è¯¯ã€‚<br>
éªŒè¯æ˜¯ binfmt_misc å¦å¼€å¯ï¼š</p>
</blockquote>
<pre><code>ğŸ³ â†’ ls -al /proc/sys/fs/binfmt_misc/
æ€»ç”¨é‡ 0
æ€»ç”¨é‡ 0
-rw-r--r-- 1 root root 0 11æœˆ 18 00:12 qemu-aarch64
-rw-r--r-- 1 root root 0 11æœˆ 18 00:12 qemu-arm
-rw-r--r-- 1 root root 0 11æœˆ 18 00:12 qemu-ppc64le
-rw-r--r-- 1 root root 0 11æœˆ 18 00:12 qemu-s390x
--w------- 1 root root 0 11æœˆ 18 00:09 register
-rw-r--r-- 1 root root 0 11æœˆ 18 00:12 status
</code></pre>
<p>éªŒè¯æ˜¯å¦å¯ç”¨äº†ç›¸åº”çš„å¤„ç†å™¨ï¼š</p>
<pre><code>ğŸ³ â†’ cat /proc/sys/fs/binfmt_misc/qemu-aarch64
enabled
interpreter /usr/bin/qemu-aarch64
flags: OCF
offset 0
magic 7f454c460201010000000000000000000200b7
mask ffffffffffffff00fffffffffffffffffeffff
</code></pre>
<h1 id="ä»é»˜è®¤çš„æ„å»ºå™¨åˆ‡æ¢åˆ°å¤šå¹³å°æ„å»ºå™¨">ä»é»˜è®¤çš„æ„å»ºå™¨åˆ‡æ¢åˆ°å¤šå¹³å°æ„å»ºå™¨</h1>
<p>åˆ›å»ºä¸€ä¸ªæ–°çš„æ„å»ºå™¨ï¼š</p>
<pre><code>ğŸ³ â†’ docker buildx create --use --name mybuilder
</code></pre>
<p>å¯åŠ¨æ„å»ºå™¨ï¼š</p>
<pre><code>ğŸ³ â†’ docker buildx inspect mybuilder --bootstrap

[+] Building 5.0s (1/1) FINISHED
 =&gt; [internal] booting buildkit                                                                                                                          5.0s
 =&gt; =&gt; pulling image moby/buildkit:buildx-stable-1                                                                                                       4.4s
 =&gt; =&gt; creating container buildx_buildkit_mybuilder0                                                                                                     0.6s
Name:   mybuilder
Driver: docker-container

Nodes:
Name:      mybuilder0
Endpoint:  unix:///var/run/docker.sock
Status:    running
Platforms: linux/amd64, linux/arm64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6
</code></pre>
<p>æŸ¥çœ‹å½“å‰ä½¿ç”¨çš„æ„å»ºå™¨åŠæ„å»ºå™¨æ”¯æŒçš„ CPU æ¶æ„ï¼Œå¯ä»¥çœ‹åˆ°æ”¯æŒå¾ˆå¤š CPU æ¶æ„ï¼š</p>
<pre><code>ğŸ³ â†’ docker buildx ls

NAME/NODE    DRIVER/ENDPOINT             STATUS  PLATFORMS
mybuilder *  docker-container
  mybuilder0 unix:///var/run/docker.sock running linux/amd64, linux/arm64, linux/ppc64le, linux/s390x, linux/386, linux/arm/v7, linux/arm/v6
default      docker
  default    default                     running linux/amd64, linux/386
</code></pre>
<h1 id="æ„å»ºå¤šå¹³å°é•œåƒ">æ„å»ºå¤šå¹³å°é•œåƒ</h1>
<pre><code>ğŸ³ â†’ docker buildx build -t maodou38/downloader --platform=linux/arm,linux/arm64,linux/amd64 . --push
</code></pre>
<blockquote>
<p>éœ€è¦æå‰é€šè¿‡ docker login å‘½ä»¤ç™»å½•è®¤è¯ Docker Hubã€‚<br>
å¦‚æœæƒ³å°†æ„å»ºå¥½çš„é•œåƒä¿å­˜åœ¨æœ¬åœ°ï¼Œå¯ä»¥å°† type æŒ‡å®šä¸º dockerï¼Œä½†å¿…é¡»åˆ†åˆ«ä¸ºä¸åŒçš„ CPU æ¶æ„æ„å»ºä¸åŒçš„é•œåƒï¼Œä¸èƒ½åˆå¹¶æˆä¸€ä¸ªé•œåƒï¼Œå³ï¼š</p>
</blockquote>
<pre><code>ğŸ³ â†’ docker buildx build -t maodou38/downloader --platform=linux/arm -o type=docker .
ğŸ³ â†’ docker buildx build -t maodou38/downloader --platform=linux/arm64 -o type=docker .
ğŸ³ â†’ docker buildx build -t maodou38/downloader --platform=linux/amd64 -o type=docker .
</code></pre>
<h1 id="æµ‹è¯•å¤šå¹³å°é•œåƒ">æµ‹è¯•å¤šå¹³å°é•œåƒ</h1>
<p>é¦–å…ˆåˆ—å‡ºæ¯ä¸ªé•œåƒçš„ digestsï¼š</p>
<pre><code>ğŸ³ â†’ docker buildx imagetools inspect maodou38/downloader

Name:      docker.io/maodou38/downloader:latest
MediaType: application/vnd.docker.distribution.manifest.list.v2+json
Digest:    sha256:ec55f5ece9a12db0c6c367acda8fd1214f50ee502902f97b72f7bff268ebc35a

Manifests:
  Name:      docker.io/maodou38/downloader:latest@sha256:38e083870044cfde7f23a2eec91e307ec645282e76fd0356a29b32122b11c639
  MediaType: application/vnd.docker.distribution.manifest.v2+json
  Platform:  linux/arm/v7

  Name:      docker.io/maodou38/downloader:latest@sha256:de273a2a3ce92a5dc1e6f2d796bb85a81fe1a61f82c4caaf08efed9cf05af66d
  MediaType: application/vnd.docker.distribution.manifest.v2+json
  Platform:  linux/arm64

  Name:      docker.io/maodou38/downloader:latest@sha256:8b735708d7d30e9cd6eb993449b1047b7229e53fbcebe940217cb36194e9e3a2
  MediaType: application/vnd.docker.distribution.manifest.v2+json
  Platform:  linux/amd64
</code></pre>
<p>è¿è¡Œæ¯ä¸€ä¸ªé•œåƒå¹¶è§‚å¯Ÿè¾“å‡ºç»“æœï¼š</p>
<pre><code>ğŸ³ â†’ docker run --rm docker.io/maodou38/downloader:latest@sha256:38e083870044cfde7f23a2eec91e307ec645282e76fd0356a29b32122b11c639
Hello, arm!

ğŸ³ â†’ docker run --rm docker.io/maodou38/downloader:latest@sha256:de273a2a3ce92a5dc1e6f2d796bb85a81fe1a61f82c4caaf08efed9cf05af66d
Hello, arm64!

ğŸ³ â†’ docker run --rm docker.io/maodou38/downloader:latest@sha256:8b735708d7d30e9cd6eb993449b1047b7229e53fbcebe940217cb36194e9e3a2
Hello, amd64!
</code></pre>

            </div>
            
              <div class="tag-container">
                
                  <a href="https://maodou38.github.io/0uebfnyNe/" class="tag">
                    docker
                  </a>
                
              </div>
            
            
              <div class="next-post">
                <div class="next">ä¸‹ä¸€ç¯‡</div>
                <a href="https://maodou38.github.io/centos-use/">
                  <h3 class="post-title">
                    Centos
                  </h3>
                </a>
              </div>
            

            
              
                <div id="gitalk-container" data-aos="fade-in"></div>
              

              
            

          </div>

        </div>
      </div>
    </div>

    <script src="https://unpkg.com/aos@next/dist/aos.js"></script>
<script type="application/javascript">

AOS.init();

var app = new Vue({
  el: '#app',
  data: {
    menuVisible: false,
  },
})

</script>


  <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  <script>
    hljs.initHighlightingOnLoad()
  </script>




  
    <script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
    <script>

      var gitalk = new Gitalk({
        clientID: '17ec64f773b1afaef948',
        clientSecret: '27224f5f2766e28963056872d67b6b477a06f19a',
        repo: 'comment',
        owner: 'maodou38',
        admin: ['maodou38'],
        id: (location.pathname).substring(0, 49),      // Ensure uniqueness and length less than 50
        distractionFreeMode: false  // Facebook-like distraction free mode
      })

      gitalk.render('gitalk-container')

    </script>
  

  




  </body>
</html>
